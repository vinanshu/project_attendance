"use strict";var ls=Object.create;var Dt=Object.defineProperty;var us=Object.getOwnPropertyDescriptor;var ps=Object.getOwnPropertyNames;var ds=Object.getPrototypeOf,ms=Object.prototype.hasOwnProperty;var Vr=r=>{throw TypeError(r)};var He=(r,e)=>()=>(r&&(e=r(r=0)),e);var Ae=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),pe=(r,e)=>{for(var t in e)Dt(r,t,{get:e[t],enumerable:!0})},Qr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ps(e))!ms.call(r,i)&&i!==t&&Dt(r,i,{get:()=>e[i],enumerable:!(n=us(e,i))||n.enumerable});return r};var _=(r,e,t)=>(t=r!=null?ls(ds(r)):{},Qr(e||!r||!r.__esModule?Dt(t,"default",{value:r,enumerable:!0}):t,r)),fs=r=>Qr(Dt({},"__esModule",{value:!0}),r);var Xt=(r,e,t)=>e.has(r)||Vr("Cannot "+t);var o=(r,e,t)=>(Xt(r,e,"read from private field"),t?t.call(r):e.get(r)),h=(r,e,t)=>e.has(r)?Vr("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),y=(r,e,t,n)=>(Xt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),u=(r,e,t)=>(Xt(r,e,"access private method"),t);var de=(r,e,t,n)=>({set _(i){y(r,e,i,t)},get _(){return o(r,e,n)}});var ys,S,f=He(()=>{"use strict";ys=()=>typeof document>"u"?new URL(`file:${__filename}`).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href,S=ys()});var ut=Ae((Fo,C)=>{"use strict";f();var Fn=9007199254740991,Dn=function(r){return r}();function ji(r){return r===Dn}function vn(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function Hi(r){return Object.prototype.toString.call(r)=="[object Date]"}function zt(r){return r!==null&&typeof r=="object"}function Gt(r){return typeof r=="function"}function qi(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Fn}function Wi(r){return Object.prototype.toString.call(r)=="[object Array]"}function In(r){return zt(r)&&!Gt(r)&&qi(r.length)}function Dr(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function Vi(r,e){return Array.prototype.map.call(r,e)}function Qi(r,e){var t=Dn;return Gt(e)&&Array.prototype.every.call(r,function(n,i,s){var a=e(n,i,s);return a&&(t=n),!a}),t}function $i(r){return Object.assign.apply(null,arguments)}function Mn(r){var e,t,n;if(vn(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return Dr(r)?new Uint8Array(r):zt(r)&&Dr(r.buffer)?new Uint8Array(r.buffer):In(r)?new Uint8Array(r):zt(r)&&Gt(r.toString)?Mn(r.toString()):new Uint8Array}C.exports.MAX_SAFE_INTEGER=Fn;C.exports.isUndefined=ji;C.exports.isString=vn;C.exports.isObject=zt;C.exports.isDateTime=Hi;C.exports.isFunction=Gt;C.exports.isArray=Wi;C.exports.isArrayLike=In;C.exports.isArrayBuffer=Dr;C.exports.map=Vi;C.exports.find=Qi;C.exports.extend=$i;C.exports.toUint8Array=Mn});var pt=Ae((vo,Rn)=>{"use strict";f();var vr="\0";Rn.exports={NULL_CHAR:vr,TMAGIC:"ustar"+vr+"00",OLDGNU_MAGIC:"ustar  "+vr,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var Rr=Ae((Mo,L)=>{"use strict";f();var Nn=ut(),I=pt(),Yi=512,Ir=I.TPERMALL,On=0,_n=0,Mr=[["name",100,0,function(r,e){return dt(r[e[0]],e[1])},function(r,e,t){return we(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||Ir;return t=t&I.TPERMMASK,Re(t,e[1],Ir)},function(r,e,t){var n=X(r.slice(e,e+t[1]));return n&=I.TPERMMASK,n}],["uid",8,108,function(r,e){return Re(r[e[0]],e[1],On)},function(r,e,t){return X(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return Re(r[e[0]],e[1],_n)},function(r,e,t){return X(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return Re(r.data.length,e[1])},function(r,e,t){return X(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return jt(r[e[0]],e[1])},function(r,e,t){return Ht(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return X(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return we(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return I.TMAGIC},function(r,e,t){return Ki(we(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==I.TMAGIC||r[e[0]]==I.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return dt(r[e[0]],e[1])},function(r,e,t){return we(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return dt(r[e[0]],e[1])},function(r,e,t){return we(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return X(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return X(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return dt(r[e[0]],e[1])},function(r,e,t){return we(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return jt(r[e[0]],e[1])},function(r,e,t){return Ht(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return jt(r[e[0]],e[1])},function(r,e,t){return Ht(r.slice(e,e+t[1]))}]],Bn=function(r){var e=r[r.length-1];return e[2]+e[1]}(Mr);function Ki(r){if(r.length==8){var e=r.split("");if(e[5]==I.NULL_CHAR)return(e[6]==" "||e[6]==I.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==I.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==I.TMAGIC?e:r;if(e[7]==I.NULL_CHAR)return e[5]==I.NULL_CHAR&&(e[5]=" "),e[6]==I.NULL_CHAR&&(e[6]=" "),e==I.OLDGNU_MAGIC?e:r}return r}function dt(r,e){return e-=1,Nn.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+I.NULL_CHAR}function Re(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+I.NULL_CHAR}function jt(r,e){if(Nn.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return Re(r,e,0)}function we(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(I.NULL_CHAR);return n>=0?t.substr(0,n):t}function X(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function Ht(r){return r.length==0||r[0]==0?null:new Date(1e3*X(r))}function Xi(r,e,t){var n=parseInt(e,10)||0,i=Math.min(n+Bn,r.length),s=0,a=0,c=0;t&&Mr.every(function(m){return m[0]=="checksum"?(a=n+m[2],c=a+m[1],!1):!0});for(var l=32,p=n;p<i;p++){var d=p>=a&&p<c?l:r[p];s=(s+d)%262144}return s}L.exports.recordSize=Yi;L.exports.defaultFileMode=Ir;L.exports.defaultUid=On;L.exports.defaultGid=_n;L.exports.posixHeader=Mr;L.exports.effectiveHeaderSize=Bn;L.exports.calculateChecksum=Xi;L.exports.formatTarString=dt;L.exports.formatTarNumber=Re;L.exports.formatTarDateTime=jt;L.exports.parseTarString=we;L.exports.parseTarNumber=X;L.exports.parseTarDateTime=Ht});var Ln=Ae((No,Cn)=>{"use strict";f();var Ji=pt(),qt=ut(),ne=Rr();function kn(r){return ne.recordSize}function Un(r){return Math.ceil(r.data.length/ne.recordSize)*ne.recordSize}function Zi(r){var e=0;return r.forEach(function(t){e+=kn(t)+Un(t)}),e+=ne.recordSize*2,new Uint8Array(e)}function ea(r,e,t){t=parseInt(t)||0;var n=t;ne.posixHeader.forEach(function(l){for(var p=l[3](e,l),d=p.length,m=0;m<d;m+=1)r[n+m]=p.charCodeAt(m)&255;n+=l[1]});var i=qt.find(ne.posixHeader,function(l){return l[0]=="checksum"});if(i){var s=ne.calculateChecksum(r,t,!0),a=ne.formatTarNumber(s,i[1]-2)+Ji.NULL_CHAR+" ";n=t+i[2];for(var c=0;c<a.length;c+=1)r[n]=a.charCodeAt(c)&255,n++}return t+kn(e)}function ta(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+Un(e)}function ra(r){r=qt.map(r,function(n){return qt.extend({},n,{data:qt.toUint8Array(n.data)})});var e=Zi(r),t=0;return r.forEach(function(n){t=ea(e,n,t),t=ta(e,n,t)}),e}Cn.exports.tar=ra});var Gn=Ae((_o,zn)=>{"use strict";f();var na=pt(),Or=ut(),q=Rr(),sa={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},ia={size:!0,checksum:!0,ustar:!0},Nr={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function aa(r){return q.recordSize}function oa(r){return Math.ceil(r/q.recordSize)*q.recordSize}function ca(r,e){for(var t=e,n=Math.min(r.length,e+q.recordSize*2),i=t;i<n;i++)if(r[i]!=0)return!1;return!0}function la(r,e,t){if(r.length-e<q.recordSize){if(t.checkFileSize)throw new Error(Nr.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},i=e;if(q.posixHeader.forEach(function(c){n[c[0]]=c[4](r,i,c),i+=c[1]}),n.type!=0&&(n.size=0),t.checkHeader&&q.posixHeader.forEach(function(c){if(Or.isFunction(c[5])&&!c[5](n,c)){var l=new Error(Nr.fileCorrupted);throw l.data={offset:e+c[2],field:c[0]},l}}),t.checkChecksum){var s=q.calculateChecksum(r,e,!0);if(s!=n.checksum){var a=new Error(Nr.checksumCheckFailed);throw a.data={offset:e,header:n,checksum:s},a}}return n}function ua(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function pa(r,e){var t={};return q.posixHeader.forEach(function(n){var i=n[0];ia[i]||(t[i]=r[i])}),t.isOldGNUFormat=r.ustar==na.OLDGNU_MAGIC,e&&(t.data=e),t}function da(r,e){e=Or.extend({},sa,e);for(var t=[],n=0,i=r.length;i-n>=q.recordSize;){r=Or.toUint8Array(r);var s=la(r,n,e);if(!s)break;n+=aa(s);var a=ua(r,n,s,e);if(t.push(pa(s,a)),n+=oa(s.size),ca(r,n))break}return t}zn.exports.untar=da});var _r=Ae((ko,jn)=>{"use strict";f();var ma=ut(),fa=pt(),ya=Ln(),ha=Gn();ma.extend(jn.exports,ya,ha,fa)});async function kr(r,e,t="pgdata",n="auto"){let i=xa(r,e),[s,a]=await Pa(i,n),c=t+(a?".tar.gz":".tar"),l=a?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([s],c,{type:l}):new Blob([s],{type:l})}async function Xn(r,e,t){let n=new Uint8Array(await e.arrayBuffer()),i=typeof File<"u"&&e instanceof File?e.name:void 0;(wa.includes(e.type)||i?.endsWith(".tgz")||i?.endsWith(".tar.gz"))&&(n=await Aa(n));let a=(0,W.untar)(n);for(let c of a){let l=t+c.name,p=l.split("/").slice(0,-1);for(let d=1;d<=p.length;d++){let m=p.slice(0,d).join("/");r.analyzePath(m).exists||r.mkdir(m)}c.type===W.REGTYPE?(r.writeFile(l,c.data),r.utime(l,Kn(c.modifyTime),Kn(c.modifyTime))):c.type===W.DIRTYPE&&r.mkdir(l)}}function Sa(r,e){let t=[],n=i=>{r.readdir(i).forEach(a=>{if(a==="."||a==="..")return;let c=i+"/"+a,l=r.stat(c),p=r.isFile(l.mode)?r.readFile(c,{encoding:"binary"}):new Uint8Array(0);t.push({name:c.substring(e.length),mode:l.mode,size:l.size,type:r.isFile(l.mode)?W.REGTYPE:W.DIRTYPE,modifyTime:l.mtime,data:p}),r.isDir(l.mode)&&n(c)})};return n(e),t}function xa(r,e){let t=Sa(r,e);return(0,W.tar)(t)}async function Pa(r,e="auto"){if(e==="none")return[r,!1];if(typeof CompressionStream<"u")return[await Ta(r),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await Ea(r),!0];if(e==="auto")return[r,!1];throw new Error("Compression not supported in this environment")}async function Ta(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:c,done:l}=await n.read();if(l)break;c&&i.push(c)}let s=new Uint8Array(i.reduce((c,l)=>c+l.length,0)),a=0;return i.forEach(c=>{s.set(c,a),a+=c.length}),s}async function Ea(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}async function Aa(r){if(typeof CompressionStream<"u")return await Fa(r);if(typeof process<"u"&&process.versions&&process.versions.node)return await Da(r);throw new Error("Unsupported environment for decompression")}async function Fa(r){let e=new DecompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:c,done:l}=await n.read();if(l)break;c&&i.push(c)}let s=new Uint8Array(i.reduce((c,l)=>c+l.length,0)),a=0;return i.forEach(c=>{s.set(c,a),a+=c.length}),s}async function Da(r){let{promisify:e}=await import("util"),{gunzip:t}=await import("zlib");return await e(t)(r)}function Kn(r){return r?typeof r=="number"?r:Math.floor(r.getTime()/1e3):Math.floor(Date.now()/1e3)}var W,wa,Ur=He(()=>{"use strict";f();W=_(_r(),1);wa=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"]});var gt,k,se,yt,ht,va,Oe=He(()=>{"use strict";f();Ur();gt="/tmp/pglite",k=gt+"/base",se=class{constructor(e){this.dataDir=e}async init(e,t){return this.pg=e,{emscriptenOpts:t}}async syncToFs(e){}async initialSyncFs(){}async closeFs(){}async dumpTar(e,t){return kr(this.pg.Module.FS,k,e,t)}},yt=class{constructor(e,{debug:t=!1}={}){this.dataDir=e,this.debug=t}async syncToFs(e){}async initialSyncFs(){}async closeFs(){}async dumpTar(e,t){return kr(this.pg.Module.FS,k,e,t)}async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],i=>{let s=va(i,this);i.FS.mkdir(k),i.FS.mount(s,{},k)}]}}}},ht={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},va=(r,e)=>{let t=r.FS,n=e.debug?console.log:null,i={tryFSOperation(s){try{return s()}catch(a){throw a.code?a.code==="UNKNOWN"?new t.ErrnoError(ht.EINVAL):new t.ErrnoError(a.code):a}},mount(s){return i.createNode(null,"/",16895,0)},syncfs(s,a,c){},createNode(s,a,c,l){if(!t.isDir(c)&&!t.isFile(c))throw new t.ErrnoError(28);let p=t.createNode(s,a,c);return p.node_ops=i.node_ops,p.stream_ops=i.stream_ops,p},getMode:function(s){return n?.("getMode",s),i.tryFSOperation(()=>e.lstat(s).mode)},realPath:function(s){let a=[];for(;s.parent!==s;)a.push(s.name),s=s.parent;return a.push(s.mount.opts.root),a.reverse(),a.join("/")},node_ops:{getattr(s){n?.("getattr",i.realPath(s));let a=i.realPath(s);return i.tryFSOperation(()=>{let c=e.lstat(a);return{...c,dev:0,ino:s.id,nlink:1,rdev:s.rdev,atime:new Date(c.atime),mtime:new Date(c.mtime),ctime:new Date(c.ctime)}})},setattr(s,a){n?.("setattr",i.realPath(s),a);let c=i.realPath(s);i.tryFSOperation(()=>{a.mode!==void 0&&e.chmod(c,a.mode),a.size!==void 0&&e.truncate(c,a.size),a.timestamp!==void 0&&e.utimes(c,a.timestamp,a.timestamp),a.size!==void 0&&e.truncate(c,a.size)})},lookup(s,a){n?.("lookup",i.realPath(s),a);let c=[i.realPath(s),a].join("/"),l=i.getMode(c);return i.createNode(s,a,l)},mknod(s,a,c,l){n?.("mknod",i.realPath(s),a,c,l);let p=i.createNode(s,a,c,l),d=i.realPath(p);return i.tryFSOperation(()=>(t.isDir(p.mode)?e.mkdir(d,{mode:c}):e.writeFile(d,"",{mode:c}),p))},rename(s,a,c){n?.("rename",i.realPath(s),i.realPath(a),c);let l=i.realPath(s),p=[i.realPath(a),c].join("/");i.tryFSOperation(()=>{e.rename(l,p)}),s.name=c},unlink(s,a){n?.("unlink",i.realPath(s),a);let c=[i.realPath(s),a].join("/");try{e.unlink(c)}catch{}},rmdir(s,a){n?.("rmdir",i.realPath(s),a);let c=[i.realPath(s),a].join("/");return i.tryFSOperation(()=>{e.rmdir(c)})},readdir(s){n?.("readdir",i.realPath(s));let a=i.realPath(s);return i.tryFSOperation(()=>e.readdir(a))},symlink(s,a,c){throw n?.("symlink",i.realPath(s),a,c),new t.ErrnoError(63)},readlink(s){throw n?.("readlink",i.realPath(s)),new t.ErrnoError(63)}},stream_ops:{open(s){n?.("open stream",i.realPath(s.node));let a=i.realPath(s.node);return i.tryFSOperation(()=>{t.isFile(s.node.mode)&&(s.shared.refcount=1,s.nfd=e.open(a))})},close(s){return n?.("close stream",i.realPath(s.node)),i.tryFSOperation(()=>{t.isFile(s.node.mode)&&s.nfd&&--s.shared.refcount===0&&e.close(s.nfd)})},dup(s){n?.("dup stream",i.realPath(s.node)),s.shared.refcount++},read(s,a,c,l,p){return n?.("read stream",i.realPath(s.node),c,l,p),l===0?0:i.tryFSOperation(()=>e.read(s.nfd,a,c,l,p))},write(s,a,c,l,p){return n?.("write stream",i.realPath(s.node),c,l,p),i.tryFSOperation(()=>e.write(s.nfd,a.buffer,c,l,p))},llseek(s,a,c){n?.("llseek stream",i.realPath(s.node),a,c);let l=a;if(c===1?l+=s.position:c===2&&t.isFile(s.node.mode)&&i.tryFSOperation(()=>{let p=e.fstat(s.nfd);l+=p.size}),l<0)throw new t.ErrnoError(28);return l},mmap(s,a,c,l,p){if(n?.("mmap stream",i.realPath(s.node),a,c,l,p),!t.isFile(s.node.mode))throw new t.ErrnoError(ht.ENODEV);let d=r.mmapAlloc(a);return i.stream_ops.read(s,r.HEAP8,d,a,c),{ptr:d,allocated:!0}},msync(s,a,c,l,p){return n?.("msync stream",i.realPath(s.node),c,l,p),i.stream_ops.write(s,a,0,l,c),0}}};return i}});var Jn={};pe(Jn,{NodeFS:()=>Cr});var Wt,Vt,Cr,Zn=He(()=>{"use strict";f();Wt=_(require("fs"),1),Vt=_(require("path"),1);Oe();Cr=class extends se{constructor(e){super(e),this.rootDir=Vt.resolve(e),Wt.existsSync(Vt.join(this.rootDir))||Wt.mkdirSync(this.rootDir)}async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],i=>{let s=i.FS.filesystems.NODEFS;i.FS.mkdir(k),i.FS.mount(s,{root:this.rootDir},k)}]}}}async closeFs(){this.pg.Module.FS.quit()}}});var rs={};pe(rs,{OpfsAhpFS:()=>zr});var Ia,Ma,Lr,wt,Ue,ie,St,M,J,O,xt,ae,oe,Q,g,es,Se,ke,V,N,bt,ts,Gr,zr,A,ns=He(()=>{"use strict";f();Oe();Ia="state.txt",Ma="data",Lr={DIR:16384,FILE:32768},zr=class extends yt{constructor(t,{initialPoolSize:n=1e3,maintainedPoolSize:i=100,debug:s=!1}={}){super(t,{debug:s});h(this,g);h(this,wt);h(this,Ue);h(this,ie);h(this,St);h(this,M);h(this,J,new Map);h(this,O,new Map);h(this,xt,0);h(this,ae,new Map);h(this,oe,new Map);this.lastCheckpoint=0;this.checkpointInterval=1e3*60;this.poolCounter=0;h(this,Q,new Set);this.initialPoolSize=n,this.maintainedPoolSize=i}async init(t,n){return await u(this,g,es).call(this),super.init(t,n)}async syncToFs(t=!1){await this.maybeCheckpointState(),await this.maintainPool(),t||this.flush()}async closeFs(){for(let t of o(this,O).values())t.close();o(this,M).flush(),o(this,M).close(),this.pg.Module.FS.quit()}async maintainPool(t){t=t||this.maintainedPoolSize;let n=t-this.state.pool.length,i=[];for(let s=0;s<n;s++)i.push(new Promise(async a=>{++this.poolCounter;let c=`${(Date.now()-1704063600).toString(16).padStart(8,"0")}-${this.poolCounter.toString(16).padStart(8,"0")}`,l=await o(this,ie).getFileHandle(c,{create:!0}),p=await l.createSyncAccessHandle();o(this,J).set(c,l),o(this,O).set(c,p),u(this,g,ke).call(this,{opp:"createPoolFile",args:[c]}),this.state.pool.push(c),a()}));for(let s=0;s>n;s--)i.push(new Promise(async a=>{let c=this.state.pool.pop();u(this,g,ke).call(this,{opp:"deletePoolFile",args:[c]});let l=o(this,J).get(c);o(this,O).get(c)?.close(),await o(this,ie).removeEntry(l.name),o(this,J).delete(c),o(this,O).delete(c),a()}));await Promise.all(i)}_createPoolFileState(t){this.state.pool.push(t)}_deletePoolFileState(t){let n=this.state.pool.indexOf(t);n>-1&&this.state.pool.splice(n,1)}async maybeCheckpointState(){Date.now()-this.lastCheckpoint>this.checkpointInterval&&await this.checkpointState()}async checkpointState(){let t=new TextEncoder().encode(JSON.stringify(this.state));o(this,M).truncate(0),o(this,M).write(t,{at:0}),o(this,M).flush(),this.lastCheckpoint=Date.now()}flush(){for(let t of o(this,Q))try{t.flush()}catch{}o(this,Q).clear()}chmod(t,n){u(this,g,Se).call(this,{opp:"chmod",args:[t,n]},()=>{this._chmodState(t,n)})}_chmodState(t,n){let i=u(this,g,N).call(this,t);i.mode=n}close(t){let n=u(this,g,bt).call(this,t);o(this,ae).delete(t),o(this,oe).delete(n)}fstat(t){let n=u(this,g,bt).call(this,t);return this.lstat(n)}lstat(t){let n=u(this,g,N).call(this,t),i=n.type==="file"?o(this,O).get(n.backingFilename).getSize():0,s=4096;return{dev:0,ino:0,mode:n.mode,nlink:1,uid:0,gid:0,rdev:0,size:i,blksize:s,blocks:Math.ceil(i/s),atime:n.lastModified,mtime:n.lastModified,ctime:n.lastModified}}mkdir(t,n){u(this,g,Se).call(this,{opp:"mkdir",args:[t,n]},()=>{this._mkdirState(t,n)})}_mkdirState(t,n){let i=u(this,g,V).call(this,t),s=i.pop(),a=[],c=this.state.root;for(let p of i){if(a.push(t),!Object.prototype.hasOwnProperty.call(c.children,p))if(n?.recursive)this.mkdir(a.join("/"));else throw new A("ENOENT","No such file or directory");if(c.children[p].type!=="directory")throw new A("ENOTDIR","Not a directory");c=c.children[p]}if(Object.prototype.hasOwnProperty.call(c.children,s))throw new A("EEXIST","File exists");let l={type:"directory",lastModified:Date.now(),mode:n?.mode||Lr.DIR,children:{}};c.children[s]=l}open(t,n,i){if(u(this,g,N).call(this,t).type!=="file")throw new A("EISDIR","Is a directory");let a=u(this,g,ts).call(this);return o(this,ae).set(a,t),o(this,oe).set(t,a),a}readdir(t){let n=u(this,g,N).call(this,t);if(n.type!=="directory")throw new A("ENOTDIR","Not a directory");return Object.keys(n.children)}read(t,n,i,s,a){let c=u(this,g,bt).call(this,t),l=u(this,g,N).call(this,c);if(l.type!=="file")throw new A("EISDIR","Is a directory");return o(this,O).get(l.backingFilename).read(new Uint8Array(n.buffer,i,s),{at:a})}rename(t,n){u(this,g,Se).call(this,{opp:"rename",args:[t,n]},()=>{this._renameState(t,n,!0)})}_renameState(t,n,i=!1){let s=u(this,g,V).call(this,t),a=s.pop(),c=u(this,g,N).call(this,s.join("/"));if(!Object.prototype.hasOwnProperty.call(c.children,a))throw new A("ENOENT","No such file or directory");let l=u(this,g,V).call(this,n),p=l.pop(),d=u(this,g,N).call(this,l.join("/"));if(i&&Object.prototype.hasOwnProperty.call(d.children,p)){let m=d.children[p];o(this,O).get(m.backingFilename).truncate(0),this.state.pool.push(m.backingFilename)}d.children[p]=c.children[a],delete c.children[a]}rmdir(t){u(this,g,Se).call(this,{opp:"rmdir",args:[t]},()=>{this._rmdirState(t)})}_rmdirState(t){let n=u(this,g,V).call(this,t),i=n.pop(),s=u(this,g,N).call(this,n.join("/"));if(!Object.prototype.hasOwnProperty.call(s.children,i))throw new A("ENOENT","No such file or directory");let a=s.children[i];if(a.type!=="directory")throw new A("ENOTDIR","Not a directory");if(Object.keys(a.children).length>0)throw new A("ENOTEMPTY","Directory not empty");delete s.children[i]}truncate(t,n=0){let i=u(this,g,N).call(this,t);if(i.type!=="file")throw new A("EISDIR","Is a directory");let s=o(this,O).get(i.backingFilename);if(!s)throw new A("ENOENT","No such file or directory");s.truncate(n),o(this,Q).add(s)}unlink(t){u(this,g,Se).call(this,{opp:"unlink",args:[t]},()=>{this._unlinkState(t,!0)})}_unlinkState(t,n=!1){let i=u(this,g,V).call(this,t),s=i.pop(),a=u(this,g,N).call(this,i.join("/"));if(!Object.prototype.hasOwnProperty.call(a.children,s))throw new A("ENOENT","No such file or directory");let c=a.children[s];if(c.type!=="file")throw new A("EISDIR","Is a directory");if(delete a.children[s],n){let l=o(this,O).get(c.backingFilename);l?.truncate(0),o(this,Q).add(l),o(this,oe).has(t)&&(o(this,ae).delete(o(this,oe).get(t)),o(this,oe).delete(t))}this.state.pool.push(c.backingFilename)}utimes(t,n,i){u(this,g,Se).call(this,{opp:"utimes",args:[t,n,i]},()=>{this._utimesState(t,n,i)})}_utimesState(t,n,i){let s=u(this,g,N).call(this,t);s.lastModified=i}writeFile(t,n,i){let s=u(this,g,V).call(this,t),a=s.pop(),c=u(this,g,N).call(this,s.join("/"));if(Object.prototype.hasOwnProperty.call(c.children,a)){let d=c.children[a];d.lastModified=Date.now(),u(this,g,ke).call(this,{opp:"setLastModified",args:[t,d.lastModified]})}else{if(this.state.pool.length===0)throw new Error("No more file handles available in the pool");let d={type:"file",lastModified:Date.now(),mode:i?.mode||Lr.FILE,backingFilename:this.state.pool.pop()};c.children[a]=d,u(this,g,ke).call(this,{opp:"createFileNode",args:[t,d]})}let l=c.children[a],p=o(this,O).get(l.backingFilename);n.length>0&&(p.write(typeof n=="string"?new TextEncoder().encode(n):new Uint8Array(n),{at:0}),t.startsWith("/pg_wal")&&o(this,Q).add(p))}_createFileNodeState(t,n){let i=u(this,g,V).call(this,t),s=i.pop(),a=u(this,g,N).call(this,i.join("/"));a.children[s]=n;let c=this.state.pool.indexOf(n.backingFilename);return c>-1&&this.state.pool.splice(c,1),n}_setLastModifiedState(t,n){let i=u(this,g,N).call(this,t);i.lastModified=n}write(t,n,i,s,a){let c=u(this,g,bt).call(this,t),l=u(this,g,N).call(this,c);if(l.type!=="file")throw new A("EISDIR","Is a directory");let p=o(this,O).get(l.backingFilename);if(!p)throw new A("EBADF","Bad file descriptor");let d=p.write(new Uint8Array(n,i,s),{at:a});return c.startsWith("/pg_wal")&&o(this,Q).add(p),d}};wt=new WeakMap,Ue=new WeakMap,ie=new WeakMap,St=new WeakMap,M=new WeakMap,J=new WeakMap,O=new WeakMap,xt=new WeakMap,ae=new WeakMap,oe=new WeakMap,Q=new WeakMap,g=new WeakSet,es=async function(){y(this,wt,await navigator.storage.getDirectory()),y(this,Ue,await u(this,g,Gr).call(this,this.dataDir,{create:!0})),y(this,ie,await u(this,g,Gr).call(this,Ma,{from:o(this,Ue),create:!0})),y(this,St,await o(this,Ue).getFileHandle(Ia,{create:!0})),y(this,M,await o(this,St).createSyncAccessHandle());let t=new ArrayBuffer(o(this,M).getSize());o(this,M).read(t,{at:0});let n,i=new TextDecoder().decode(t).split(`
`),s=!1;try{n=JSON.parse(i[0])}catch{n={root:{type:"directory",lastModified:Date.now(),mode:Lr.DIR,children:{}},pool:[]},o(this,M).truncate(0),o(this,M).write(new TextEncoder().encode(JSON.stringify(n)),{at:0}),s=!0}this.state=n;let a=i.slice(1).filter(Boolean).map(d=>JSON.parse(d));for(let d of a){let m=`_${d.opp}State`;if(typeof this[m]=="function")try{this[m].bind(this)(...d.args)}catch(x){console.warn("Error applying OPFS AHP WAL entry",d,x)}}let c=[],l=async d=>{if(d.type==="file")try{let m=await o(this,ie).getFileHandle(d.backingFilename),x=await m.createSyncAccessHandle();o(this,J).set(d.backingFilename,m),o(this,O).set(d.backingFilename,x)}catch(m){console.error("Error opening file handle for node",d,m)}else for(let m of Object.values(d.children))c.push(l(m))};await l(this.state.root);let p=[];for(let d of this.state.pool)p.push(new Promise(async m=>{o(this,J).has(d)&&console.warn("File handle already exists for pool file",d);let x=await o(this,ie).getFileHandle(d),E=await x.createSyncAccessHandle();o(this,J).set(d,x),o(this,O).set(d,E),m()}));await Promise.all([...c,...p]),await this.maintainPool(s?this.initialPoolSize:this.maintainedPoolSize)},Se=function(t,n){let i=u(this,g,ke).call(this,t);try{n()}catch(s){throw o(this,M).truncate(i),s}},ke=function(t){let n=JSON.stringify(t),i=new TextEncoder().encode(`
${n}`),s=o(this,M).getSize();return o(this,M).write(i,{at:s}),o(this,Q).add(o(this,M)),s},V=function(t){return t.split("/").filter(Boolean)},N=function(t,n){let i=u(this,g,V).call(this,t),s=n||this.state.root;for(let a of i){if(s.type!=="directory")throw new A("ENOTDIR","Not a directory");if(!Object.prototype.hasOwnProperty.call(s.children,a))throw new A("ENOENT","No such file or directory");s=s.children[a]}return s},bt=function(t){let n=o(this,ae).get(t);if(!n)throw new A("EBADF","Bad file descriptor");return n},ts=function(){let t=++de(this,xt)._;for(;o(this,ae).has(t);)de(this,xt)._++;return t},Gr=async function(t,n){let i=u(this,g,V).call(this,t),s=n?.from||o(this,wt);for(let a of i)s=await s.getDirectoryHandle(a,{create:n?.create});return s};A=class extends Error{constructor(e,t){super(t),typeof e=="number"?this.code=e:typeof e=="string"&&(this.code=ht[e])}}});var Ra={};pe(Ra,{IdbFs:()=>_e,MemoryFS:()=>Be,Mutex:()=>ee,PGlite:()=>jr,formatQuery:()=>Qn,messages:()=>ot,parse:()=>pr,protocol:()=>Ar,types:()=>ur,uuid:()=>Vn});module.exports=fs(Ra);f();f();f();var _a=new Error("timeout while waiting for mutex to become available"),Ba=new Error("mutex already locked"),hs=new Error("request for lock canceled"),gs=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function c(d){try{p(n.next(d))}catch(m){a(m)}}function l(d){try{p(n.throw(d))}catch(m){a(m)}}function p(d){d.done?s(d.value):i(d.value).then(c,l)}p((n=n.apply(r,e||[])).next())})},Jt=class{constructor(e,t=hs){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return gs(this,void 0,void 0,function*(){let[n,i]=yield this.acquire(t);try{return yield e(n)}finally{i()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;let i=this._value,s=t;this._value-=t,t=this._value+1,n.resolve([i,this._newReleaser(s)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},bs=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function c(d){try{p(n.next(d))}catch(m){a(m)}}function l(d){try{p(n.throw(d))}catch(m){a(m)}}function p(d){d.done?s(d.value):i(d.value).then(c,l)}p((n=n.apply(r,e||[])).next())})},ee=class{constructor(e){this._semaphore=new Jt(1,e)}acquire(){return bs(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};f();f();var $r={part:"part",container:"container"};function vt(r,e,...t){let n=r.length-1,i=t.length-1;if(i!==-1){if(i===0){r[n]=r[n]+t[0]+e;return}r[n]=r[n]+t[0],r.push(...t.slice(1,i)),r.push(t[i]+e)}}function ws(r,...e){let t=[r[0]];t.raw=[r.raw[0]];let n=[];for(let i=0;i<e.length;i++){let s=e[i],a=i+1;if(s?._templateType===$r.part){vt(t,r[a],s.str),vt(t.raw,r.raw[a],s.str);continue}if(s?._templateType===$r.container){vt(t,r[a],...s.strings),vt(t.raw,r.raw[a],...s.strings.raw),n.push(...s.values);continue}t.push(r[a]),t.raw.push(r.raw[a]),n.push(s)}return{_templateType:"container",strings:t,values:n}}function Zt(r,...e){let{strings:t,values:n}=ws(r,...e);return{query:[t[0],...n.flatMap((i,s)=>[`$${s+1}`,t[s+1]])].join(""),params:n}}var pr={};pe(pr,{parseDescribeStatementResults:()=>We,parseResults:()=>Rt});f();var ur={};pe(ur,{ABSTIME:()=>Os,ACLITEM:()=>Gs,BIT:()=>Ws,BOOL:()=>tr,BPCHAR:()=>en,BYTEA:()=>rr,CHAR:()=>Ps,CID:()=>Fs,CIDR:()=>Ns,CIRCLE:()=>ks,DATE:()=>rn,FLOAT4:()=>Jr,FLOAT8:()=>Zr,GTSVECTOR:()=>oi,INET:()=>zs,INT2:()=>Yr,INT4:()=>Kr,INT8:()=>nr,INTERVAL:()=>Hs,JSON:()=>sr,JSONB:()=>sn,MACADDR:()=>Ls,MACADDR8:()=>Us,MONEY:()=>Cs,NUMERIC:()=>Qs,OID:()=>Xr,PATH:()=>Ms,PG_DEPENDENCIES:()=>si,PG_LSN:()=>ri,PG_NDISTINCT:()=>ni,PG_NODE_TREE:()=>vs,POLYGON:()=>Rs,REFCURSOR:()=>$s,REGCLASS:()=>Js,REGCONFIG:()=>ci,REGDICTIONARY:()=>li,REGNAMESPACE:()=>ui,REGOPER:()=>Ks,REGOPERATOR:()=>Xs,REGPROC:()=>Ts,REGPROCEDURE:()=>Ys,REGROLE:()=>pi,REGTYPE:()=>Zs,RELTIME:()=>_s,SMGR:()=>Is,TEXT:()=>qe,TID:()=>Es,TIME:()=>js,TIMESTAMP:()=>nn,TIMESTAMPTZ:()=>ir,TIMETZ:()=>qs,TINTERVAL:()=>Bs,TSQUERY:()=>ai,TSVECTOR:()=>ii,TXID_SNAPSHOT:()=>ti,UUID:()=>ei,VARBIT:()=>Vs,VARCHAR:()=>tn,XID:()=>As,XML:()=>Ds,arrayParser:()=>lr,arraySerializer:()=>Mt,parseType:()=>It,parsers:()=>or,serializers:()=>cr,types:()=>an});f();var Ss=globalThis.JSON.parse,xs=globalThis.JSON.stringify,tr=16,rr=17,Ps=18,nr=20,Yr=21,Kr=23,Ts=24,qe=25,Xr=26,Es=27,As=28,Fs=29,sr=114,Ds=142,vs=194,Is=210,Ms=602,Rs=604,Ns=650,Jr=700,Zr=701,Os=702,_s=703,Bs=704,ks=718,Us=774,Cs=790,Ls=829,zs=869,Gs=1033,en=1042,tn=1043,rn=1082,js=1083,nn=1114,ir=1184,Hs=1186,qs=1266,Ws=1560,Vs=1562,Qs=1700,$s=1790,Ys=2202,Ks=2203,Xs=2204,Js=2205,Zs=2206,ei=2950,ti=2970,ri=3220,ni=3361,si=3402,ii=3614,ai=3615,oi=3642,ci=3734,li=3769,sn=3802,ui=4089,pi=4096,an={string:{to:qe,from:[qe,tn,en],serialize:r=>{if(typeof r=="string")return r;if(typeof r=="number")return r.toString();throw new Error("Invalid input for string type")},parse:r=>r},number:{to:0,from:[Yr,Kr,Xr,Jr,Zr],serialize:r=>r.toString(),parse:r=>+r},bigint:{to:nr,from:[nr],serialize:r=>r.toString(),parse:r=>{let e=BigInt(r);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:sr,from:[sr,sn],serialize:r=>typeof r=="string"?r:xs(r),parse:r=>Ss(r)},boolean:{to:tr,from:[tr],serialize:r=>{if(typeof r!="boolean")throw new Error("Invalid input for boolean type");return r?"t":"f"},parse:r=>r==="t"},date:{to:ir,from:[rn,nn,ir],serialize:r=>{if(typeof r=="string")return r;if(typeof r=="number")return new Date(r).toISOString();if(r instanceof Date)return r.toISOString();throw new Error("Invalid input for date type")},parse:r=>new Date(r)},bytea:{to:rr,from:[rr],serialize:r=>{if(!(r instanceof Uint8Array))throw new Error("Invalid input for bytea type");return"\\x"+Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")},parse:r=>{let e=r.slice(2);return Uint8Array.from({length:e.length/2},(t,n)=>parseInt(e.substring(n*2,(n+1)*2),16))}}},ar=di(an),or=ar.parsers,cr=ar.serializers;function It(r,e,t){if(r===null)return null;let n=t?.[e]??ar.parsers[e];return n?n(r,e):r}function di(r){return Object.keys(r).reduce(({parsers:e,serializers:t},n)=>{let{to:i,from:s,serialize:a,parse:c}=r[n];return t[i]=a,t[n]=a,e[n]=c,Array.isArray(s)?s.forEach(l=>{e[l]=c,t[l]=a}):(e[s]=c,t[s]=a),{parsers:e,serializers:t}},{parsers:{},serializers:{}})}var mi=/\\/g,fi=/"/g;function yi(r){return r.replace(mi,"\\\\").replace(fi,'\\"')}function Mt(r,e,t){if(Array.isArray(r)===!1)return r;if(!r.length)return"{}";let n=r[0],i=t===1020?";":",";return Array.isArray(n)?`{${r.map(s=>Mt(s,e,t)).join(i)}}`:`{${r.map(s=>(s===void 0&&(s=null),s===null?"null":'"'+yi(e?e(s):s.toString())+'"')).join(i)}}`}var er={i:0,char:null,str:"",quoted:!1,last:0,p:null};function lr(r,e,t){return er.i=er.last=0,on(er,r,e,t)[0]}function on(r,e,t,n){let i=[],s=n===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(i.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,i.push(on(r,e,t,n));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&i.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===s&&r.p!=="}"&&r.p!=='"'&&(i.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&i.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),i}function Rt(r,e,t,n){let i=[],s={rows:[],fields:[]},a=0,c={...e,...t?.parsers},l=r.filter(p=>p.name==="rowDescription"||p.name==="dataRow"||p.name==="commandComplete");return l.forEach((p,d)=>{if(p.name==="rowDescription"){let m=p;s.fields=m.fields.map(x=>({name:x.name,dataTypeID:x.dataTypeID}))}else if(p.name==="dataRow"&&s){let m=p;t?.rowMode==="array"?s.rows.push(m.fields.map((x,E)=>It(x,s.fields[E].dataTypeID,c))):s.rows.push(Object.fromEntries(m.fields.map((x,E)=>[s.fields[E].name,It(x,s.fields[E].dataTypeID,c)])))}else p.name==="commandComplete"&&(a+=hi(p),d===l.length-1?i.push({...s,affectedRows:a,...n?{blob:n}:{}}):i.push(s),s={rows:[],fields:[]})}),i.length===0&&i.push({rows:[],fields:[]}),i}function hi(r){let e=r.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}function We(r){let e=r.find(t=>t.name==="parameterDescription");return e?e.dataTypeIDs:[]}var Ar={};pe(Ar,{Parser:()=>ge,messages:()=>ot,serialize:()=>F});f();f();f();f();function Fe(r){let e=r.length;for(let t=r.length-1;t>=0;t--){let n=r.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}var D,v,ve,Ot,Ie,U,Nt,De,cn,me=class{constructor(e=256){this.size=e;h(this,U);h(this,D);h(this,v,5);h(this,ve,!1);h(this,Ot,new TextEncoder);h(this,Ie,0);y(this,D,u(this,U,Nt).call(this,e))}addInt32(e){return u(this,U,De).call(this,4),o(this,D).setInt32(o(this,v),e,o(this,ve)),y(this,v,o(this,v)+4),this}addInt16(e){return u(this,U,De).call(this,2),o(this,D).setInt16(o(this,v),e,o(this,ve)),y(this,v,o(this,v)+2),this}addCString(e){return e&&this.addString(e),u(this,U,De).call(this,1),o(this,D).setUint8(o(this,v),0),de(this,v)._++,this}addString(e=""){let t=Fe(e);return u(this,U,De).call(this,t),o(this,Ot).encodeInto(e,new Uint8Array(o(this,D).buffer,o(this,v))),y(this,v,o(this,v)+t),this}add(e){return u(this,U,De).call(this,e.byteLength),new Uint8Array(o(this,D).buffer).set(new Uint8Array(e),o(this,v)),y(this,v,o(this,v)+e.byteLength),this}flush(e){let t=u(this,U,cn).call(this,e);return y(this,v,5),y(this,D,u(this,U,Nt).call(this,this.size)),new Uint8Array(t)}};D=new WeakMap,v=new WeakMap,ve=new WeakMap,Ot=new WeakMap,Ie=new WeakMap,U=new WeakSet,Nt=function(e){return new DataView(new ArrayBuffer(e))},De=function(e){if(o(this,D).byteLength-o(this,v)<e){let n=o(this,D).buffer,i=n.byteLength+(n.byteLength>>1)+e;y(this,D,u(this,U,Nt).call(this,i)),new Uint8Array(o(this,D).buffer).set(new Uint8Array(n))}},cn=function(e){if(e){o(this,D).setUint8(o(this,Ie),e);let t=o(this,v)-(o(this,Ie)+1);o(this,D).setInt32(o(this,Ie)+1,t,o(this,ve))}return o(this,D).buffer.slice(e?0:5,o(this,v))};var T=new me,gi=r=>{T.addInt16(3).addInt16(0);for(let n of Object.keys(r))T.addCString(n).addCString(r[n]);T.addCString("client_encoding").addCString("UTF8");let e=T.addCString("").flush(),t=e.byteLength+4;return new me().addInt32(t).add(e).flush()},bi=()=>{let r=new DataView(new ArrayBuffer(8));return r.setInt32(0,8,!1),r.setInt32(4,80877103,!1),new Uint8Array(r.buffer)},wi=r=>T.addCString(r).flush(112),Si=(r,e)=>(T.addCString(r).addInt32(Fe(e)).addString(e),T.flush(112)),xi=r=>T.addString(r).flush(112),Pi=r=>T.addCString(r).flush(81),Ti=[],Ei=r=>{let e=r.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=T.addCString(e).addCString(r.text).addInt16(r.types?.length??0);return r.types?.forEach(n=>t.addInt32(n)),T.flush(80)},Me=new me;var Ai=(r,e)=>{for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];if(n===null)T.addInt16(0),Me.addInt32(-1);else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)){let i=ArrayBuffer.isView(n)?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):n;T.addInt16(1),Me.addInt32(i.byteLength),Me.add(i)}else T.addInt16(0),Me.addInt32(Fe(n)),Me.addString(n)}},Fi=(r={})=>{let e=r.portal??"",t=r.statement??"",n=r.binary??!1,i=r.values??Ti,s=i.length;return T.addCString(e).addCString(t),T.addInt16(s),Ai(i,r.valueMapper),T.addInt16(s),T.add(Me.flush()),T.addInt16(n?1:0),T.flush(66)},Di=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),vi=r=>{if(!r||!r.portal&&!r.rows)return Di;let e=r.portal??"",t=r.rows??0,n=Fe(e),i=4+n+1+4,s=new DataView(new ArrayBuffer(1+i));return s.setUint8(0,69),s.setInt32(1,i,!1),new TextEncoder().encodeInto(e,new Uint8Array(s.buffer,5)),s.setUint8(n+5,0),s.setUint32(s.byteLength-4,t,!1),new Uint8Array(s.buffer)},Ii=(r,e)=>{let t=new DataView(new ArrayBuffer(16));return t.setInt32(0,16,!1),t.setInt16(4,1234,!1),t.setInt16(6,5678,!1),t.setInt32(8,r,!1),t.setInt32(12,e,!1),new Uint8Array(t.buffer)},dr=(r,e)=>{let t=new me;return t.addCString(e),t.flush(r)},Mi=T.addCString("P").flush(68),Ri=T.addCString("S").flush(68),Ni=r=>r.name?dr(68,`${r.type}${r.name??""}`):r.type==="P"?Mi:Ri,Oi=r=>{let e=`${r.type}${r.name??""}`;return dr(67,e)},_i=r=>T.add(r).flush(100),Bi=r=>dr(102,r),_t=r=>new Uint8Array([r,0,0,0,4]),ki=_t(72),Ui=_t(83),Ci=_t(88),Li=_t(99),F={startup:gi,password:wi,requestSsl:bi,sendSASLInitialResponseMessage:Si,sendSCRAMClientFinalMessage:xi,query:Pi,parse:Ei,bind:Fi,execute:vi,describe:Ni,close:Oi,flush:()=>ki,sync:()=>Ui,end:()=>Ci,copyData:_i,copyDone:()=>Li,copyFail:Bi,cancel:Ii};f();var ot={};pe(ot,{AuthenticationCleartextPassword:()=>Qe,AuthenticationMD5Password:()=>$e,AuthenticationOk:()=>Ve,AuthenticationSASL:()=>Ye,AuthenticationSASLContinue:()=>Ke,AuthenticationSASLFinal:()=>Xe,BackendKeyDataMessage:()=>st,CommandCompleteMessage:()=>ye,CopyDataMessage:()=>Je,CopyResponse:()=>Ze,DataRowMessage:()=>at,DatabaseError:()=>te,Field:()=>et,NoticeMessage:()=>he,NotificationResponseMessage:()=>fe,ParameterDescriptionMessage:()=>rt,ParameterStatusMessage:()=>nt,ReadyForQueryMessage:()=>it,RowDescriptionMessage:()=>tt,bindComplete:()=>fr,closeComplete:()=>yr,copyDone:()=>Sr,emptyQuery:()=>wr,noData:()=>hr,parseComplete:()=>mr,portalSuspended:()=>gr,replicationStart:()=>br});f();var mr={name:"parseComplete",length:5},fr={name:"bindComplete",length:5},yr={name:"closeComplete",length:5},hr={name:"noData",length:5},gr={name:"portalSuspended",length:5},br={name:"replicationStart",length:4},wr={name:"emptyQuery",length:4},Sr={name:"copyDone",length:4},Ve=class{constructor(e){this.length=e;this.name="authenticationOk"}},Qe=class{constructor(e){this.length=e;this.name="authenticationCleartextPassword"}},$e=class{constructor(e,t){this.length=e;this.salt=t;this.name="authenticationMD5Password"}},Ye=class{constructor(e,t){this.length=e;this.mechanisms=t;this.name="authenticationSASL"}},Ke=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLContinue"}},Xe=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLFinal"}},te=class extends Error{constructor(t,n,i){super(t);this.length=n;this.name=i}},Je=class{constructor(e,t){this.length=e;this.chunk=t;this.name="copyData"}},Ze=class{constructor(e,t,n,i){this.length=e;this.name=t;this.binary=n;this.columnTypes=new Array(i)}},et=class{constructor(e,t,n,i,s,a,c){this.name=e;this.tableID=t;this.columnID=n;this.dataTypeID=i;this.dataTypeSize=s;this.dataTypeModifier=a;this.format=c}},tt=class{constructor(e,t){this.length=e;this.fieldCount=t;this.name="rowDescription";this.fields=new Array(this.fieldCount)}},rt=class{constructor(e,t){this.length=e;this.parameterCount=t;this.name="parameterDescription";this.dataTypeIDs=new Array(this.parameterCount)}},nt=class{constructor(e,t,n){this.length=e;this.parameterName=t;this.parameterValue=n;this.name="parameterStatus"}},st=class{constructor(e,t,n){this.length=e;this.processID=t;this.secretKey=n;this.name="backendKeyData"}},fe=class{constructor(e,t,n,i){this.length=e;this.processId=t;this.channel=n;this.payload=i;this.name="notification"}},it=class{constructor(e,t){this.length=e;this.status=t;this.name="readyForQuery"}},ye=class{constructor(e,t){this.length=e;this.text=t;this.name="commandComplete"}},at=class{constructor(e,t){this.length=e;this.fields=t;this.name="dataRow";this.fieldCount=t.length}},he=class{constructor(e,t){this.length=e;this.message=t;this.name="notice"}};f();var xr={text:0,binary:1};f();var zi=new ArrayBuffer(0),K,R,kt,Ut,ct,Bt=class{constructor(e=0){h(this,K,new DataView(zi));h(this,R);h(this,kt,"utf-8");h(this,Ut,new TextDecoder(o(this,kt)));h(this,ct,!1);y(this,R,e)}setBuffer(e,t){y(this,R,e),y(this,K,new DataView(t))}int16(){let e=o(this,K).getInt16(o(this,R),o(this,ct));return y(this,R,o(this,R)+2),e}byte(){let e=o(this,K).getUint8(o(this,R));return de(this,R)._++,e}int32(){let e=o(this,K).getInt32(o(this,R),o(this,ct));return y(this,R,o(this,R)+4),e}string(e){return o(this,Ut).decode(this.bytes(e))}cstring(){let e=o(this,R),t=e;for(;o(this,K).getUint8(t++)!==0;);let n=this.string(t-e-1);return y(this,R,t),n}bytes(e){let t=o(this,K).buffer.slice(o(this,R),o(this,R)+e);return y(this,R,o(this,R)+e),new Uint8Array(t)}};K=new WeakMap,R=new WeakMap,kt=new WeakMap,Ut=new WeakMap,ct=new WeakMap;var Pr=1,Gi=4,ln=Pr+Gi,un=new ArrayBuffer(0);var B,z,G,b,w,pn,dn,mn,fn,yn,hn,gn,Tr,bn,wn,Sn,xn,Pn,Tn,En,An,Er,ge=class{constructor(){h(this,w);h(this,B,new DataView(un));h(this,z,0);h(this,G,0);h(this,b,new Bt)}parse(e,t){u(this,w,pn).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);let n=o(this,G)+o(this,z),i=o(this,G);for(;i+ln<=n;){let s=o(this,B).getUint8(i),a=o(this,B).getUint32(i+Pr,!1),c=Pr+a;if(c+i<=n){let l=u(this,w,dn).call(this,i+ln,s,a,o(this,B).buffer);t(l),i+=c}else break}i===n?(y(this,B,new DataView(un)),y(this,z,0),y(this,G,0)):(y(this,z,n-i),y(this,G,i))}};B=new WeakMap,z=new WeakMap,G=new WeakMap,b=new WeakMap,w=new WeakSet,pn=function(e){if(o(this,z)>0){let t=o(this,z)+e.byteLength;if(t+o(this,G)>o(this,B).byteLength){let i;if(t<=o(this,B).byteLength&&o(this,G)>=o(this,z))i=o(this,B).buffer;else{let s=o(this,B).byteLength*2;for(;t>=s;)s*=2;i=new ArrayBuffer(s)}new Uint8Array(i).set(new Uint8Array(o(this,B).buffer,o(this,G),o(this,z))),y(this,B,new DataView(i)),y(this,G,0)}new Uint8Array(o(this,B).buffer).set(new Uint8Array(e),o(this,G)+o(this,z)),y(this,z,t)}else y(this,B,new DataView(e)),y(this,G,0),y(this,z,e.byteLength)},dn=function(e,t,n,i){switch(t){case 50:return fr;case 49:return mr;case 51:return yr;case 110:return hr;case 115:return gr;case 99:return Sr;case 87:return br;case 73:return wr;case 68:return u(this,w,Pn).call(this,e,n,i);case 67:return u(this,w,fn).call(this,e,n,i);case 90:return u(this,w,mn).call(this,e,n,i);case 65:return u(this,w,bn).call(this,e,n,i);case 82:return u(this,w,An).call(this,e,n,i);case 83:return u(this,w,Tn).call(this,e,n,i);case 75:return u(this,w,En).call(this,e,n,i);case 69:return u(this,w,Er).call(this,e,n,i,"error");case 78:return u(this,w,Er).call(this,e,n,i,"notice");case 84:return u(this,w,wn).call(this,e,n,i);case 116:return u(this,w,xn).call(this,e,n,i);case 71:return u(this,w,hn).call(this,e,n,i);case 72:return u(this,w,gn).call(this,e,n,i);case 100:return u(this,w,yn).call(this,e,n,i);default:return new te("received invalid response: "+t.toString(16),n,"error")}},mn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).string(1);return new it(t,i)},fn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).cstring();return new ye(t,i)},yn=function(e,t,n){let i=n.slice(e,e+(t-4));return new Je(t,new Uint8Array(i))},hn=function(e,t,n){return u(this,w,Tr).call(this,e,t,n,"copyInResponse")},gn=function(e,t,n){return u(this,w,Tr).call(this,e,t,n,"copyOutResponse")},Tr=function(e,t,n,i){o(this,b).setBuffer(e,n);let s=o(this,b).byte()!==0,a=o(this,b).int16(),c=new Ze(t,i,s,a);for(let l=0;l<a;l++)c.columnTypes[l]=o(this,b).int16();return c},bn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).int32(),s=o(this,b).cstring(),a=o(this,b).cstring();return new fe(t,i,s,a)},wn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).int16(),s=new tt(t,i);for(let a=0;a<i;a++)s.fields[a]=u(this,w,Sn).call(this);return s},Sn=function(){let e=o(this,b).cstring(),t=o(this,b).int32(),n=o(this,b).int16(),i=o(this,b).int32(),s=o(this,b).int16(),a=o(this,b).int32(),c=o(this,b).int16()===0?xr.text:xr.binary;return new et(e,t,n,i,s,a,c)},xn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).int16(),s=new rt(t,i);for(let a=0;a<i;a++)s.dataTypeIDs[a]=o(this,b).int32();return s},Pn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).int16(),s=new Array(i);for(let a=0;a<i;a++){let c=o(this,b).int32();s[a]=c===-1?null:o(this,b).string(c)}return new at(t,s)},Tn=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).cstring(),s=o(this,b).cstring();return new nt(t,i,s)},En=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).int32(),s=o(this,b).int32();return new st(t,i,s)},An=function(e,t,n){o(this,b).setBuffer(e,n);let i=o(this,b).int32();switch(i){case 0:return new Ve(t);case 3:return new Qe(t);case 5:return new $e(t,o(this,b).bytes(4));case 10:{let s=[];for(;;){let a=o(this,b).cstring();if(a.length===0)return new Ye(t,s);s.push(a)}}case 11:return new Ke(t,o(this,b).string(t-8));case 12:return new Xe(t,o(this,b).string(t-8));default:throw new Error("Unknown authenticationOk message type "+i)}},Er=function(e,t,n,i){o(this,b).setBuffer(e,n);let s={},a=o(this,b).string(1);for(;a!=="\0";)s[a]=o(this,b).cstring(),a=o(this,b).string(1);let c=s.M,l=i==="notice"?new he(t,c):new te(c,t,i);return l.severity=s.S,l.code=s.C,l.detail=s.D,l.hint=s.H,l.position=s.P,l.internalPosition=s.p,l.internalQuery=s.q,l.where=s.W,l.schema=s.s,l.table=s.t,l.column=s.c,l.dataType=s.d,l.constraint=s.n,l.file=s.F,l.line=s.L,l.routine=s.R,l};var lt,re,P,j,Ct,be,Fr,Lt=class{constructor(){h(this,P);this.serializers={...cr};this.parsers={...or};h(this,lt,!1);h(this,re,!1)}async _initArrayTypes(){if(o(this,lt))return;y(this,lt,!0);let e=await this.query(`
      SELECT b.oid, b.typarray
      FROM pg_catalog.pg_type a
      LEFT JOIN pg_catalog.pg_type b ON b.oid = a.typelem
      WHERE a.typcategory = 'A'
      GROUP BY b.oid, b.typarray
      ORDER BY b.oid
    `);for(let t of e.rows)this.serializers[t.typarray]=n=>Mt(n,this.serializers[t.oid],t.typarray),this.parsers[t.typarray]=n=>lr(n,this.parsers[t.oid],t.typarray)}async query(e,t,n){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await u(this,P,Ct).call(this,e,t,n))}async sql(e,...t){let{query:n,params:i}=Zt(e,...t);return await this.query(n,i)}async exec(e,t){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await u(this,P,be).call(this,e,t))}async describeQuery(e,t){try{await u(this,P,j).call(this,F.parse({text:e,types:t?.paramTypes}),t);let n=await u(this,P,j).call(this,F.describe({type:"S"}),t),i=n.messages.find(l=>l.name==="parameterDescription"),s=n.messages.find(l=>l.name==="rowDescription"),a=i?.dataTypeIDs.map(l=>({dataTypeID:l,serializer:this.serializers[l]}))??[],c=s?.fields.map(l=>({name:l.name,dataTypeID:l.dataTypeID,parser:this.parsers[l.dataTypeID]}))??[];return{queryParams:a,resultFields:c}}finally{await u(this,P,j).call(this,F.sync(),t)}}async transaction(e){return await this._checkReady(),await this._runExclusiveTransaction(async()=>{await u(this,P,be).call(this,"BEGIN"),y(this,re,!0);let t=!1,n=()=>{if(t)throw new Error("Transaction is closed")},i={query:async(s,a,c)=>(n(),await u(this,P,Ct).call(this,s,a,c)),sql:async(s,...a)=>{let{query:c,params:l}=Zt(s,...a);return await u(this,P,Ct).call(this,c,l)},exec:async(s,a)=>(n(),await u(this,P,be).call(this,s,a)),rollback:async()=>{n(),await u(this,P,be).call(this,"ROLLBACK"),t=!0},get closed(){return t}};try{let s=await e(i);return t||(t=!0,await u(this,P,be).call(this,"COMMIT")),y(this,re,!1),s}catch(s){throw t||await u(this,P,be).call(this,"ROLLBACK"),y(this,re,!1),s}})}};lt=new WeakMap,re=new WeakMap,P=new WeakSet,j=async function(e,t={}){return await this.execProtocol(e,{...t,syncToFs:!1})},Ct=async function(e,t=[],n){return await this._runExclusiveQuery(async()=>{u(this,P,Fr).call(this,"runQuery",e,t,n),await this._handleBlob(n?.blob);let i;try{let{messages:a}=await u(this,P,j).call(this,F.parse({text:e,types:n?.paramTypes}),n),c=We((await u(this,P,j).call(this,F.describe({type:"S"}),n)).messages),l=t.map((p,d)=>{let m=c[d];if(p==null)return null;let x=n?.serializers?.[m]??this.serializers[m];return x?x(p):p.toString()});i=[...a,...(await u(this,P,j).call(this,F.bind({values:l}),n)).messages,...(await u(this,P,j).call(this,F.describe({type:"P"}),n)).messages,...(await u(this,P,j).call(this,F.execute({}),n)).messages]}finally{await u(this,P,j).call(this,F.sync(),n)}await this._cleanupBlob(),o(this,re)||await this.syncToFs();let s=await this._getWrittenBlob();return Rt(i,this.parsers,n,s)[0]})},be=async function(e,t){return await this._runExclusiveQuery(async()=>{u(this,P,Fr).call(this,"runExec",e,t),await this._handleBlob(t?.blob);let n;try{n=(await u(this,P,j).call(this,F.query(e),t)).messages}finally{await u(this,P,j).call(this,F.sync(),t)}this._cleanupBlob(),o(this,re)||await this.syncToFs();let i=await this._getWrittenBlob();return Rt(n,this.parsers,t,i)})},Fr=function(...e){this.debug>0&&console.log(...e)};f();var $n=_(_r(),1);f();var ft=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",mt;async function Hn(){if(ft||mt)return;let r=new URL("./postgres.wasm",S);mt=fetch(r)}var Ne;async function qn(r,e){if(e||Ne)return WebAssembly.instantiate(e||Ne,r),{instance:await WebAssembly.instantiate(e||Ne,r),module:e||Ne};let t=new URL("./postgres.wasm",S);if(ft){let i=await(await import("fs/promises")).readFile(t),{module:s,instance:a}=await WebAssembly.instantiate(i,r);return Ne=s,{instance:a,module:s}}else{mt||(mt=fetch(t));let n=await mt,{module:i,instance:s}=await WebAssembly.instantiateStreaming(n,r);return Ne=i,{instance:s,module:i}}}async function Wn(){let r=new URL("./postgres.data",S);return ft?(await(await import("fs/promises")).readFile(r)).buffer:(await fetch(r)).arrayBuffer()}var Vn=()=>{if(globalThis.crypto?.randomUUID)return globalThis.crypto.randomUUID();let r=new Uint8Array(16);if(globalThis.crypto?.getRandomValues)globalThis.crypto.getRandomValues(r);else for(let t=0;t<r.length;t++)r[t]=Math.floor(Math.random()*256);r[6]=r[6]&15|64,r[8]=r[8]&63|128;let e=[];return r.forEach(t=>{e.push(t.toString(16).padStart(2,"0"))}),e.slice(0,4).join("")+"-"+e.slice(4,6).join("")+"-"+e.slice(6,8).join("")+"-"+e.slice(8,10).join("")+"-"+e.slice(10).join("")};async function Qn(r,e,t,n){if(!t||t.length===0)return e;n=n??r;let i;try{await r.execProtocol(F.parse({text:e}),{syncToFs:!1}),i=We((await r.execProtocol(F.describe({type:"S"}),{syncToFs:!1})).messages)}finally{await r.execProtocol(F.sync(),{syncToFs:!1})}let s=e.replace(/\$([0-9]+)/g,(c,l)=>"%"+l+"L");return(await n.query(`SELECT format($1, ${t.map((c,l)=>`$${l+2}`).join(", ")}) as query`,[s,...t],{paramTypes:[qe,...i]})).rows[0].query}async function Br(r){if(ft){let e=await import("fs"),t=await import("zlib"),{Writable:n}=await import("stream"),{pipeline:i}=await import("stream/promises");if(!e.existsSync(r))throw new Error(`Extension bundle not found: ${r}`);let s=t.createGunzip(),a=[];return await i(e.createReadStream(r),s,new n({write(c,l,p){a.push(c),p()}})),new Blob(a)}else{let e=await fetch(r.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let t=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(t)).blob()}}}async function Yn(r,e){for(let t in r.pg_extensions){let n;try{n=await r.pg_extensions[t]}catch(i){console.error("Failed to fetch extension:",t,i);continue}if(n){let i=new Uint8Array(await n.arrayBuffer());ga(r,t,i,e)}else console.error("Could not get binary data for extension:",t)}}function ga(r,e,t,n){$n.default.untar(t).forEach(s=>{if(!s.name.startsWith(".")){let a=r.WASM_PREFIX+"/"+s.name;if(s.name.endsWith(".so")){let c=(...p)=>{n("pgfs:ext OK",a,p)},l=(...p)=>{n("pgfs:ext FAIL",a,p)};r.FS.createPreloadedFile(ba(a),s.name.split("/").pop().slice(0,-3),s.data,!0,!0,c,l,!1)}else r.FS.writeFile(a,s.data)}})}function ba(r){let e=r.lastIndexOf("/");return e>0?r.slice(0,e):r}f();f();Oe();var _e=class extends se{async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],i=>{let s=i.FS.filesystems.IDBFS;i.FS.mkdir("/pglite"),i.FS.mkdir(`/pglite/${this.dataDir}`),i.FS.mount(s,{},`/pglite/${this.dataDir}`),i.FS.symlink(`/pglite/${this.dataDir}`,k)}]}}}initialSyncFs(){return new Promise((e,t)=>{this.pg.Module.FS.syncfs(!0,n=>{n?t(n):e()})})}syncToFs(e){return new Promise((t,n)=>{this.pg.Module.FS.syncfs(!1,i=>{i?n(i):t()})})}async closeFs(){let e=this.pg.Module.FS.filesystems.IDBFS.dbs[this.dataDir];e&&e.close(),this.pg.Module.FS.quit()}};f();Oe();var Be=class extends se{async closeFs(){this.pg.Module.FS.quit()}};Oe();function ss(r){let e;if(r?.startsWith("file://")){if(r=r.slice(7),!r)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else r?.startsWith("idb://")?(r=r.slice(6),e="idbfs"):r?.startsWith("opfs-ahp://")?(r=r.slice(11),e="opfs-ahp"):!r||r?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:r,fsType:e}}async function is(r,e){let t;if(r&&e==="nodefs"){let{NodeFS:n}=await Promise.resolve().then(()=>(Zn(),Jn));t=new n(r)}else if(r&&e==="idbfs")t=new _e(r);else if(r&&e==="opfs-ahp"){let{OpfsAhpFS:n}=await Promise.resolve().then(()=>(ns(),rs));t=new n(r)}else t=new Be;return t}Ur();f();var as=_(require("./postgres.cjs").default,1),os=as.default;var Ce,xe,Pe,Le,ze,Qt,$t,Yt,Ge,Tt,Et,At,Te,ce,H,Ee,Z,cs,Pt,Hr=class Hr extends Lt{constructor(t={},n={}){super();h(this,Z);h(this,Ce,!1);h(this,xe,!1);h(this,Pe,!1);h(this,Le,!1);h(this,ze,!1);h(this,Qt,new ee);h(this,$t,new ee);h(this,Yt,new ee);h(this,Ge,!1);this.debug=0;h(this,Tt);h(this,Et,[]);h(this,At,new ge);h(this,Te);h(this,ce);h(this,H,new Map);h(this,Ee,new Set);typeof t=="string"?n={dataDir:t,...n}:n=t,this.dataDir=n.dataDir,n.parsers!==void 0&&(this.parsers={...this.parsers,...n.parsers}),n.serializers!==void 0&&(this.serializers={...this.serializers,...n.serializers}),n?.debug!==void 0&&(this.debug=n.debug),n?.relaxedDurability!==void 0&&y(this,ze,n.relaxedDurability),y(this,Tt,n.extensions??{}),this.waitReady=u(this,Z,cs).call(this,n??{})}static async create(t,n){let i=typeof t=="string"?{dataDir:t,...n??{}}:t??{},s=new Hr(i);return await s.waitReady,s}get Module(){return this.mod}get ready(){return o(this,Ce)&&!o(this,xe)&&!o(this,Pe)}get closed(){return o(this,Pe)}async close(){await this._checkReady(),y(this,xe,!0);for(let t of o(this,Et))await t();try{await this.execProtocol(F.end()),this.mod._pg_shutdown()}catch(t){let n=t;if(!(n.name==="ExitStatus"&&n.status===0))throw t}await this.fs.closeFs(),y(this,Pe,!0),y(this,xe,!1)}async[Symbol.asyncDispose](){await this.close()}async _handleBlob(t){y(this,Te,t?await t.arrayBuffer():void 0)}async _cleanupBlob(){y(this,Te,void 0)}async _getWrittenBlob(){if(!o(this,ce))return;let t=new Blob(o(this,ce));return y(this,ce,void 0),t}async _checkReady(){if(o(this,xe))throw new Error("PGlite is closing");if(o(this,Pe))throw new Error("PGlite is closed");o(this,Ce)||await this.waitReady}async execProtocolRaw(t,{syncToFs:n=!0}={}){let i=t.length,s=this.mod;s._interactive_write(i),s.HEAPU8.set(t,1),s._interactive_one();let a=i+2,c=a+s._interactive_read(),l=s.HEAPU8.subarray(a,c);return n&&await this.syncToFs(),l}async execProtocol(t,{syncToFs:n=!0,throwOnError:i=!0,onNotice:s}={}){let a=await this.execProtocolRaw(t,{syncToFs:n}),c=[];return o(this,At).parse(a,l=>{if(l instanceof te){if(y(this,At,new ge),i)throw l}else if(l instanceof he)this.debug>0&&console.warn(l),s&&s(l);else if(l instanceof ye)switch(l.text){case"BEGIN":y(this,Le,!0);break;case"COMMIT":case"ROLLBACK":y(this,Le,!1);break}else if(l instanceof fe){let p=o(this,H).get(l.channel);p&&p.forEach(d=>{queueMicrotask(()=>d(l.payload))}),o(this,Ee).forEach(d=>{queueMicrotask(()=>d(l.channel,l.payload))})}c.push(l)}),{messages:c,data:a}}isInTransaction(){return o(this,Le)}async syncToFs(){if(o(this,Ge))return;y(this,Ge,!0);let t=async()=>{await o(this,Yt).runExclusive(async()=>{y(this,Ge,!1),await this.fs.syncToFs(o(this,ze))})};o(this,ze)?t():await t()}async listen(t,n){return o(this,H).has(t)||o(this,H).set(t,new Set),o(this,H).get(t).add(n),await this.exec(`LISTEN "${t}"`),async()=>{await this.unlisten(t,n)}}async unlisten(t,n){n?(o(this,H).get(t)?.delete(n),o(this,H).get(t)?.size===0&&(await this.exec(`UNLISTEN "${t}"`),o(this,H).delete(t))):(await this.exec(`UNLISTEN "${t}"`),o(this,H).delete(t))}onNotification(t){return o(this,Ee).add(t),()=>{o(this,Ee).delete(t)}}offNotification(t){o(this,Ee).delete(t)}async dumpDataDir(t){let n=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(n,t)}_runExclusiveQuery(t){return o(this,Qt).runExclusive(t)}_runExclusiveTransaction(t){return o(this,$t).runExclusive(t)}};Ce=new WeakMap,xe=new WeakMap,Pe=new WeakMap,Le=new WeakMap,ze=new WeakMap,Qt=new WeakMap,$t=new WeakMap,Yt=new WeakMap,Ge=new WeakMap,Tt=new WeakMap,Et=new WeakMap,At=new WeakMap,Te=new WeakMap,ce=new WeakMap,H=new WeakMap,Ee=new WeakMap,Z=new WeakSet,cs=async function(t){if(t.fs)this.fs=t.fs;else{let{dataDir:m,fsType:x}=ss(t.dataDir);this.fs=await is(m,x)}let n={},i=[],s=[`PGDATA=${k}`,`PREFIX=${gt}`,`PGUSER=${t.username??"postgres"}`,`PGDATABASE=${t.database??"template1"}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]];t.wasmModule||Hn();let a=t.fsBundle?t.fsBundle.arrayBuffer():Wn(),c;a.then(m=>{c=m});let l={WASM_PREFIX:gt,arguments:s,INITIAL_MEMORY:t.initialMemory,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},instantiateWasm:(m,x)=>(qn(m,t.wasmModule).then(({instance:E,module:$})=>{x(E,$)}),{}),getPreloadedPackage:(m,x)=>{if(m==="postgres.data"){if(c.byteLength!==x)throw new Error(`Invalid FS bundle size: ${c.byteLength} !== ${x}`);return c}throw new Error(`Unknown package: ${m}`)},preRun:[m=>{let x=m.FS.makedev(64,0),E={open:$=>{},close:$=>{},read:($,je,le,ue,Y)=>{let qr=o(this,Te);if(!qr)throw new Error("No /dev/blob File or Blob provided to read from");let Kt=new Uint8Array(qr);if(Y>=Kt.length)return 0;let Wr=Math.min(Kt.length-Y,ue);for(let Ft=0;Ft<Wr;Ft++)je[le+Ft]=Kt[Y+Ft];return Wr},write:($,je,le,ue,Y)=>(o(this,ce)??y(this,ce,[]),o(this,ce).push(je.slice(le,le+ue)),ue),llseek:($,je,le)=>{let ue=o(this,Te);if(!ue)throw new Error("No /dev/blob File or Blob provided to llseek");let Y=je;if(le===1?Y+=$.position:le===2&&(Y=new Uint8Array(ue).length),Y<0)throw new m.FS.ErrnoError(28);return Y}};m.FS.registerDevice(x,E),m.FS.mkdev("/dev/blob",x)}]},{emscriptenOpts:p}=await this.fs.init(this,l);l=p;for(let[m,x]of Object.entries(o(this,Tt)))if(x instanceof URL)n[m]=Br(x);else{let E=await x.setup(this,l);if(E.emscriptenOpts&&(l=E.emscriptenOpts),E.namespaceObj){let $=this;$[m]=E.namespaceObj}E.bundlePath&&(n[m]=Br(E.bundlePath)),E.init&&i.push(E.init),E.close&&o(this,Et).push(E.close)}if(l.pg_extensions=n,await a,this.mod=await os(l),await this.fs.initialSyncFs(),t.loadDataDir){if(this.mod.FS.analyzePath(k+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");u(this,Z,Pt).call(this,"pglite: loading data from tarball"),await Xn(this.mod.FS,t.loadDataDir,k)}this.mod.FS.analyzePath(k+"/PG_VERSION").exists?u(this,Z,Pt).call(this,"pglite: found DB, resuming"):u(this,Z,Pt).call(this,"pglite: no db"),await Yn(this.mod,(...m)=>u(this,Z,Pt).call(this,...m));let d=this.mod._pg_initdb();if(!d)throw new Error("INITDB failed to return value");if(d&1)throw new Error("INITDB failed");if(d&2){let m=t.username??"postgres",x=t.database??"template1";if(d&4){if(!(d&12))throw new Error("Invalid db/user combination")}else if(x!=="template1"&&m!=="postgres")throw new Error("INITDB created a new datadir, but an alternative db/user was requested")}await this.syncToFs(),y(this,Ce,!0),await this.exec("SET search_path TO public;"),await this._initArrayTypes();for(let m of i)await m()},Pt=function(...t){this.debug>0&&console.log(...t)};var jr=Hr;f();0&&(module.exports={IdbFs,MemoryFS,Mutex,PGlite,formatQuery,messages,parse,protocol,types,uuid});
//# sourceMappingURL=index.cjs.map